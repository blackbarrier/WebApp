{% extends 'base.html.twig' %}

{% block title %}Turnos{% endblock %}

{% block body %}

    <style>
        #turno_hora {
            margin:20px 0;
            height: 50px;
            border: none;
            overflow: hidden;
        }
    
        #turno_hora::-moz-focus-inner {
            border: 0;
        }
    
        #turno_hora:focus {
            outline: none;
        }
    
        #turno_hora option {
            width: 80px;
            font-size: 1.2em;
            padding: 10px 0;
            text-align: center;
            margin-right: 20px;
            display: inline-block;
            cursor: pointer;
            border: #007bff solid 1px;
            border-radius: 5px;
            color: #007bff;
        }
    </style> 
    <div class="row">
        <div class="col-sm-10">
            <h1>Solicitar un turno nuevo</h1>            
        </div>
        <div class="col-sm-2">
            <a href="{{ path('app_index') }}"><button class="btn btn-inverse btn-inverse-jag btn-inverse-jag btn-outline-inverse">{{ button_label|default('Volver') }}</button></a>
        </div>
    </div>
    <br>
    <div class="col-6">        
    {{ include('turno/_form.html.twig') }}
    <br>    
    </div>
    
    

{% endblock %}
{% block javascript %}
<script>
    $(document).ready(function () {

        $("#turno_hora").hide();     
        
        $("#turno_fecha").change(function () {            
            var fechaSelect = $("#turno_fecha").val();
            var horariosOcupados;

            $.ajax({
                url: "{{path('app_turno_get_horarios')}}",
                type: 'POST',
                data: {
                    'dia' : fechaSelect
                },
                dataType:"JSON",

                success: function (response) {    

                    horariosOcupados = response;
                    console.log(horariosOcupados.turnosOcupados.length);

                    
                    $("#turno_hora option").each(function () {
                        
                        valor = $(this).val();
                        if (horariosOcupados.turnosOcupados.includes(valor)){
                            $(this).hide();
                        }else{
                            $(this).fadeIn(250);
                        }                      
                    });                    
                    
                    if(horariosOcupados.turnosOcupados.length ===7){
                        alert("Todos los horarios ocupados");
                    }
                },

                error: function (xhr, status, error, response) {
                    console.log(error)
                    alert('Error al realizar la solicitud:', error);
                    console.log(response)
                }

            });       
                            
            $("#turno_hora").fadeIn(250);           
            
        });

        var fechaInput = $('#turno_fecha');

        // Añadir el evento para cuando el usuario intente seleccionar una fecha
        fechaInput.on('change', function () {
            var selectedDate = new Date($(this).val());
            var dayOfWeek = selectedDate.getUTCDay();

            // 0 es Domingo y 6 es Sábado
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                alert('No hay atencion dias sabados o domingo.');
                $(this).val(''); // Limpiar el campo de fecha
            };
        })

       

    });
</script>
{% endblock %}